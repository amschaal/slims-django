{% extends "base.html" %}
{% load static %}
{% block 'head' %}
<script src="{% static 'select2/js/select2.full.js' %}"></script>
<link href="{% static 'select2/css/select2.css' %}" rel="stylesheet" />
<style>
.select2-container {
    width: 80% !important;
}
/* Make the Select2 dropdown more spacious */
.select2-container .select2-selection--multiple {
    min-height: 38px;  /* Height of the select box */
    border: 1px solid #ccc;  /* Border color */
    border-radius: 0.375rem;  /* Border radius for rounded corners */
}

.select2-container .select2-selection--multiple .select2-selection__rendered {
    padding: 8px;  /* Padding inside the selection box */
}

.select2-container--default .select2-selection--multiple .select2-selection__choice {
    background-color: #007bff;  /* Background color for selected items */
    color: white;  /* Text color */
    border-radius: 5px;  /* Rounded corners for selected items */
}

.select2-container .select2-dropdown {
    border-radius: 0.375rem;  /* Match border radius with selection box */
}

/* Customize search box inside the dropdown */
.select2-container .select2-search--dropdown .select2-search__field {
    padding: 6px 12px;
    border: 1px solid #ccc;
    border-radius: 0.375rem;
}
</style>
{% endblock %}
{% block 'content' %}
<h3>Group: {{group.name}} </h3>
<h3>Users</h3>
<div class="input-group">
    <select id="users-select" multiple="multiple" name="new_users"></select>
    <div class="input-group-addon input-group-button"><button class="btn btn-primary">Add users</button></div>
</div>

{% for u in group.user_set.all %}
    <div class="user" id="user-{{u.pk}}">{{u.first_name}} {{u.last_name}} (<a href="/users/{{u.pk}}/">{{u.email}}</a>)</div>
{% endfor %}
{% include 'run_history.html' %}
<script>
$(document).ready(function () {
    $('#users-select').select2({
        placeholder: "Search users to add...",
        minimumInputLength: 2,
        ajax: {
            url: '/api/users',
            dataType: 'json',
            delay: 250,
            data: function (params) {
                var query = {
                    search: params.term,
                    offset: (params.page || 0) * 10,  // Use pagination with limit/offset
                    limit: 10
                }
                return query;
            },
            processResults: function (data, params) {
                params.page = params.page || 1;
                let results = data.results.map(function(u) { return { id: u.id, text: u.first_name + ' ' + u.last_name + ' (' + u.email + ')' }})
                console.log('options', results)
                return {
                    results: results,  // Your paginated results here
                    pagination: {
                        more: data.next != null  // Check if more data is available
                    }
                };
            },
            cache: true
        }
    });
});
</script>
{% endblock %}